
\newcommand{\FigOverview}{
\begin{figure*}[t]
    \centering
    \includegraphics[width=0.60\linewidth,clip]{figures/dark-decoy-overview.png}
    \caption{\textbf{\scheme Overview}\,---\, %
    }
    \label{fig:overview}
\end{figure*}
}

\newcommand{\FigHighLevel}{
\begin{figure}[t]
    \centering
    \vspace{-0.525in}
    \includegraphics[width=\linewidth,clip]{figures/high-level.png}
    \caption{\textbf{Overview}---%
      An ISP deploys a \scheme station, which sees a passive tap of network traffic.
      Clients request service by embedding a steganographic message in a TLS connection with any reachable site at the ISP\@. The client then connects
      to an unused IP address in the client's AS, and the station
      injects packets to communicate with the client as if there were a proxy server at that address.
    }
    \label{fig:highlevel}
\end{figure}
}

\newcommand{\FigUpload}{
\begin{figure}[t]
    \centering
    \includegraphics[width=0.90\linewidth,clip]{figures/bandwidth-up.pdf}
    \caption{\textbf{Upload Performance}\,---\, %
        We used iperf to measure the upload bandwidth for a direct connection, TapDance, and \scheme.
        As expected, TapDance's upload performance is several orders of magnitude lower than
        the link capacity, due to the overhead of frequent reconnects to the decoy.
    }
    \label{fig:upload}
\end{figure}
}

\newcommand{\FigDownload}{
\begin{figure}[t]
    \centering
    \includegraphics[width=0.90\linewidth,clip]{figures/bandwidth-down.pdf}
    \caption{\textbf{Download Performance}\,---\, %
        Using iperf, we compare the download performance of a direct connection, TapDance, and \scheme.
        While TapDance can achieve link capacity download, it still has to occasionally reconnect
        to the decoy, as seen by the periodic dips. These reconnects are more common the more data
        the client sends (e.g. requests or any upload data).
    }
    \label{fig:download}
\end{figure}
}


\newcommand{\FigTapBandwidth}{
\begin{figure*}[t]
    \centering
    \includegraphics[width=0.90\linewidth,clip]{figures/decoy-tap-bandwidth.png}
    \caption{\textbf{Tap Bandwidth}\,---\, %
        We deployed our \scheme implementation in a realistic ISP testbed on a
        (full duplex) tap of a 10~Gbps router. As shown in a typical week, traffic
        ranges from 2-17~Gbps.
    }
    \label{fig:tap-bandwidth}
\end{figure*}
}




\newcommand{\FigIpBits}{
\begin{figure}[t]
    \centering
    \vspace{-0.5in}
    \includegraphics[width=\linewidth,clip]{figures/ip-bits-set-pdf.pdf}
    \caption{\textbf{IPv6 Entropy}---%
        We observed 30 minutes of IPv6 traffic on our tap to the /32 of the ISP's network.
        In each address observed, we counted the number of bits set, and compared this to
        randomly generated addresses. If the 96 non-network bits
        of each address were chosen randomly, we would expect to see a Binomial distribution
        (shown as Random). In practice, the distribution of observed IP addresses has much fewer
        bits set, suggesting that censors might be able to distinguish between dark decoy addresses
        and legitimate ones.
        %We note there are several /64 subnets that had many
        %addresses that appeared random (visibly overlapping the random distribution).
    }
    \label{fig:ipbits}
\end{figure}
}





\newcommand{\yes}{\CIRCLE}
\newcommand{\no}{\Circle}
\newcommand{\maybe}{\LEFTcircle}

\newcommand{\TabCompare}{
\begin{table*}[t]
    \centering
    \begin{tabular}{l|cccccccc}
            % Multiflow? Waterfall?
            & \rot{Telex~\cite{telex11}} &
            \rot{Cirripede~\cite{cirripede11}} &
            \rot{Decoy Routing~\cite{curveball11}} &
            \rot{TapDance~\cite{tapdance14}} & \rot{Rebound~\cite{rebound15}} & \rot{Slitheen~\cite{slitheen16}} & \rot{Waterfall~\cite{waterfall17}} & \rot{\textbf{\scheme}} \\
            \hline
                                      %Telex Cirr  DR     TD      RB    Slth   Water  DD
            No inline blocking        & \no & \no  & \no & \yes  & \no  & \no  & \no  & \yes \\
            Handles asym. routing     & \no & \yes & \no  & \yes & \yes & \no  & \yes & \yes \\
            Currently deployed        & \no & \no  & \no  & \yes & \no  & \no  & \no  & \no \\
            Replay attack resistant   &\yes & \yes & \yes & \no  & \yes & \yes & \yes & \yes \\
            Traffic analysis resitant &\no  & \no  & \no  & \no  &\maybe& \yes &\maybe& \no \\
            Uses unused addresses     & \no & \no  & \no  & \no  & \no  & \no  & \no  & \yes \\
    \end{tabular}
    \caption{\textbf{Comparing Refraction Networking schemes}\,---\,}
    \label{tab:compare}
\end{table*}
}



\newcommand{\FigImplementation}{
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.7\linewidth,clip]{figures/implementation.png}
    \caption{\textbf{Station Architecture}\,---\, %
    }
    \label{fig:implementation}
\end{figure}
}

\newcommand{\FigEvolution}{
\begin{figure}
  \centering
  \begin{subfigure}{\columnwidth}
    \includegraphics[width=\columnwidth]{figures/refraction-v1}
    \vspace{-3pt}

    \caption{\textbf{First generation systems} for Refraction Networking, such as Telex and Cirripede, operated as inline network elements, with the ability to observe traffic and block specific flows. ISPs worried that if the inline element failed, it could bring down the network.\looseness=-1}
    \label{fig:refraction-v1}
  \end{subfigure}
  \vspace{16pt}

  \begin{subfigure}{\columnwidth}
    \includegraphics[width=\columnwidth]{figures/tapdance}
    \vspace{-3pt}

    \caption{\textbf{TapDance} is a second-generation Refraction Network scheme that operates without flow blocking, needing only to passively observe traffic and inject packets. TapDance has recently been deployed at a mid-size ISP, but the techniques used to silence the decoy site and participate in the client--decoy TCP connection mid-stream add significant complexity, performance bottlenecks, and detection risk.}
    \label{fig:tapdance}
  \end{subfigure}
  \vspace{16pt}

  \begin{subfigure}{\columnwidth}
    \includegraphics[width=\columnwidth]{figures/dark-decoys}
    \vspace{-3pt}

    \caption{\textbf{\scheme}, our third-generation Refraction Networking design, overcomes these limitations.  It uses two sessions. First, the client connects to a decoy site and embeds a steganographic registration message, which the station receives using only a passive tap.  Second, the client connects to a ``dark address'' where there is no running server, and the station proxies the connection in its entirety.}
    \label{fig:dark-decoys}
  \end{subfigure}

  \vspace{12pt}
  \caption{\textbf{Evolution of Refraction Networking Approaches}}
\end{figure}
}
